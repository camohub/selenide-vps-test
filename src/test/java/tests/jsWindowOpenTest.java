package tests;

import categories.FullTest;
import org.junit.Assert;
import org.junit.Test;
import org.junit.experimental.categories.Category;
import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

import java.util.Set;


@Category({FullTest.class})
public class jsWindowOpenTest extends baseTest
{
    private String siteUrl = "/inception.php";

    @Test
    public void windowOpenTest() throws InterruptedException
    {
        driver.get(baseUrl + siteUrl);
        String parentWindow = driver.getWindowHandle();

        JavascriptExecutor js = ((JavascriptExecutor) driver);

        driver.findElement( By.id("letsGoDeeper") ).click();

        new WebDriverWait(driver, 5)
                .withMessage("btn click did not open new window!!!")
                .until(ExpectedConditions.numberOfWindowsToBe(2));

        Set<String> windows = driver.getWindowHandles();
        for (String id: windows) {
            System.out.println(id);
            driver.switchTo().window(id);
        }

        new WebDriverWait(driver, 5)
                .withMessage("Error: inception2.php form element missing.")
                .until(ExpectedConditions.presenceOfElementLocated(By.id("inceptionForm")));

        WebElement input = driver.findElement(By.id("message1"));
        input.sendKeys("beeeeeeeeeeee");
        Assert.assertEquals("beeeeeeeeeeee", input.getAttribute("value"));

        driver.close();
        driver.switchTo().window(parentWindow);

        driver.findElement( By.id("letsGoDeeper") ).click();
    }
}
